<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common :: common-head"></head>

<body>
<!-- Header с логотипом -->
<header th:replace="fragments/common :: common-header"></header>

<!-- Основной контент -->
<div class="main-content">
    <div class="p-4 rounded-3 bg-light shadow-sm mb-4">
        <h2 class="display-6 text-primary mb-2">
            Привет, <span th:text="${userName}">User</span>!
        </h2>
        <p class="lead text-muted mb-1">
            Добро пожаловать в <strong>удобную систему заказа еды</strong>!
        </p>
        <p class="text-secondary">
            Организуйте совместные заказы с коллегами — быстро, удобно и без лишней суеты.
        </p>
    </div>

    <div class="card mb-4 border-0 shadow-sm">
        <div class="card-body text-center py-4">
            <a th:href="@{/create-order}" class="btn btn-lg btn-primary w-100 py-3 fs-5">
                <i class="fas fa-utensils me-2"></i>
                Создать заказ
            </a>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h3 class="h5 mb-0">Активные заказы</h3>
        </div>
        <div class="card-body">
            <ul class="list-unstyled">
                <li th:each="order : ${activeOrders}" class="order-card">
                    <a th:href="@{/order/{id}(id=${order.id})}" th:text="${order.createdBy.fullName + ' - ' + order.restaurant.name}" class="h5 d-block text-decoration-none"></a>
                    <p class="text-muted mb-1">
                        Дедлайн: <span th:text="${#temporals.format(order.deadlineTime, 'dd.MM.yyyy HH:mm')}"></span>
                    </p>
                    <form method="post" th:action="@{/close-order/{id}(id=${order.id})}"
                          style="display:inline;"
                          th:if="${order.createdBy.id == currentUserId}">
                        <button type="submit" class="btn btn-sm btn-outline-danger">Закрыть заказ</button>
                    </form>
                </li>
            </ul>
            <!-- Если активных заказов нет -->
            <div th:if="${#lists.isEmpty(activeOrders)}" class="text-center text-muted">
                Активных заказов нет.
            </div>
        </div>
    </div>
    <div class="card mb-4">
        <div class="card-header">
            <h3 class="h5 mb-0">Закрытые заказы</h3>
        </div>
        <div class="card-body">
            <div th:if="${closedOrders.content.size() == 0}">
                <em>Нет закрытых заказов.</em>
            </div>
            <div th:each="order : ${closedOrders.content}">
                <!-- Отображение заказа -->
                <div class="order-item mb-3 p-2 border rounded">
                    <a th:href="@{/order/{id}(id=${order.id})}" th:text="${order.createdBy.fullName + ' - ' + order.restaurant.name}" class="h5 d-block text-decoration-none"></a>
                    <p>Дедлайн: <span th:text="${#temporals.format(order.deadlineTime, 'dd.MM.yyyy HH:mm')}"></span></p>
                    <p>Для оплаты: <span th:text="${order.paymentData}"></span></p>
                </div>
            </div>

            <!-- Пагинация для закрытых заказов -->
            <nav th:if="${closedOrders.totalPages > 1}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${closedOrders.number == 0} ? 'disabled'">
                        <a class="page-link" th:href="@{/(page=${closedOrders.number - 1}, size=${closedOrders.size})}">Предыдущая</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, closedOrders.totalPages - 1)}"
                        th:classappend="${i == closedOrders.number} ? 'active'">
                        <a class="page-link" th:href="@{/(page=${i}, size=${closedOrders.size})}" th:text="${i + 1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${closedOrders.number == closedOrders.totalPages - 1} ? 'disabled'">
                        <a class="page-link" th:href="@{/(page=${closedOrders.number + 1}, size=${closedOrders.size})}">Следующая</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

<!-- Bootstrap JS (опционально) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<footer th:replace="fragments/common :: common-footer"></footer>

</body>
</html>